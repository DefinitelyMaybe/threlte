---
order: 7.15
category: '@threlte/extras'
sourcePath: 'packages/extras/src/lib/components/environment/Environment.svelte'
name: <Environment>
type: 'component'
componentSignature:
  {
    props:
      [
        {
          description: 'the url to a texture to load and use',
          name: 'url',
          required: false,
          type: 'string'
        },
        {
          description: 'a bindable of the loaded texture',
          name: 'texture',
          required: false,
          type: 'THREE.DataTexture | THREE.Texture'
        },
        {
          default: 'false',
          description: 'whether to set `scene.background` to the loaded environment texture',
          name: 'isBackground',
          required: false,
          type: 'boolean'
        },
        {
          default: 'useThrelte().scene',
          description: 'the scene that will have its environment and/or background set',
          name: 'scene',
          required: false,
          type: 'THREE.Scene'
        },
        {
          default: 'false',
          description: 'creates a ground projected skybox',
          name: 'ground',
          required: false,
          type: 'boolean | { height?: number, radius?: number, resolution?: number }'
        },
        {
          default: 'undefined',
          description: 'a reference to the created `GroundedSkybox` instance when using grounded projection',
          name: 'skybox',
          required: false,
          type: 'undefined | THREE.GroundedSkybox'
        },
        {
          default: '{}',
          description: 'optional options that are passed to `loader.load`',
          name: 'loadOptions',
          required: false,
          type: 'UseLoaderLoadOptions<THREE.EXRLoader | THREE.RGBELoader | THREE.TextureLoader>'
        },
        {
          description: 'optional options that are used when creating the loader',
          name: 'loaderOptions',
          default: '{}',
          required: false,
          type: 'UseLoaderOptions<typeof THREE.EXRLoader | typeof THREE.RGBELoader | typeof THREE.TextureLoader>'
        }
      ]
  }
---

Asynchronously loads a single equirectangular-mapped texture and sets the provided scene's `environment` and or `background` to the texture. [Here](/textures/equirectangular/jpg/equirect_ruined_room.jpg) is an example of such a texture.

<Example path="extras/environment/basic" />

## Fetching, Loading, and Assigning Textures

`<Environment>`'s `url` prop is used to fetch and load textures. If it is provided, a corresponding loader will be used to fetch, load, and assign the texture to `scene.environment`.

`<Environment>` supports loading `exr`, `hdr`, and any other file type that can be loaded by ThreeJS's [TextureLoader](https://threejs.org/docs/#api/en/loaders/TextureLoader) such as `jpg` files. This means you can swap the `url` prop at any time and `<Environment>` will dispose of the previous texture and assign the new one to the scene's `environment` and/or `background` properties. Loaders within `<Environment>` are created on demand and cached for future use until `<Environment>` unmounts.

Internally `<Environment>` creates a loader based on the extension of the `url` prop. Refer to the table below to determine what kind of loader is used for a particular extension.

| extension  | loader                                                                                             |
| ---------- | -------------------------------------------------------------------------------------------------- |
| exr        | [Three.EXRLoader](https://github.com/mrdoob/three.js/blob/dev/examples/jsm/loaders/EXRLoader.js/)  |
| hdr        | [Three.RGBELoader](https://github.com/mrdoob/three.js/blob/dev/examples/jsm/loaders/RGBELoader.js) |
| all others | [Three.TextureLoader](https://threejs.org/docs/#api/en/loaders/TextureLoader)                      |

<Tip type="info">
	Any time `<Environment>` loads a texture, it will dispose of the old one. The texture is also disposed when `<Environment>` unmounts.
</Tip>

### Modifying Loaded Textures

The `loadOptions` property can be used to modify a loaded texture before it is assigned to `scene.environment`. `loadOptions` is used inside the loader's `load` function and accessed through a callback. This means that it is only read **after** a texture is loaded. By default, `loadOptions` will set the loaded texture's `mapping` property to `THREE.EquirectangularReflectionMapping`.

The example below demonstrates how updating `loadOptions` is only "picked up" when a texture is loaded. Toggling the checkbox will not cause the texture to be updated but flipping it _and then_ triggering a new texture to be loaded will respect the state of the checkbox.

<Tip type="warning">
	`loadOptions` is only accessed for newly loaded textures. Textures are cached so if a texture has already been loaded, `loadOptions` will not be called upon when updating to that texture. You are able to update the texture through the `bindable` texture property but the changes will not take be visible until the next time `<Environment>` has to assign that texture.
</Tip>

<Example path="extras/environment/modifying-the-texture" />

Although `loadOptions.transform` is only called the first time the texture is loaded, you can still update the texture throught the `texture` bindable prop.

```svelte
<script>
  let texture = $state() // undefined | Three.Texture

  let { flipY } = $props() // boolean

  $effect(() => {
    if (texture !== undefined) {
      texture.flipY = flipY
      // next time the texture is assigned, flipY will be respected
    }
  })
</script>

<Environment
  url="/path/to/file.hdr"
  bind:texture
/>
```

You can use loaded textures for other parts of your scene but be aware that the texture is assigned to `undefined` when `<Environment>` unmounts.

```svelte
<script>
  let texture = $state() // undefined | THREE.Texture
</script>

{#if texture !== undefined}
  <T.Mesh>
    <T.MeshStandardMaterial map={texture} />
  </T.Mesh>
{/if}

<Environment
  url="/path/to/file.hdr"
  bind:texture
/>
```

This is not recommended. The preferred way to reuse a texture is to load the texture using [useTexture](/docs/reference/extras/use-texture) modify it, and then pass that into `<Environment>` and to any other components or as a prop. Passing a loaded texture is explained below.

### `texture` Prop for Preloaded Textures

`<Environment>` provides a bindable `texture` prop that you can use if you've already loaded the texture somewhere else in your application. The example below provides a preloaded texture to `<Environment>` instead of having it fetch and load one.

<Example path="extras/environment/bring-your-own-texture" />

Be aware that if `<Environment>` loads a texture, it will set the `texture` bindable prop **after** it has been loaded. This means that if you provide both `url` and `texture` properties, the texture at `url` will eventually be assigned to `texture`.

```typescript title="Environment.svelte"
<Environment {texture} url="/path/to/texture/file" />
```

Loading only occurs if `url` is passed to `<Environment>`.

## Loader Options

`<Environment>` uses [useLoader](/docs/reference/core/use-loader) internally to create a loader for loading texture files. The `loaderOptions` prop is used to modify the loader after it is created and to pass argument's to the loader's constructor.

```svelte title="Environment.svelte"
<!-- Note this is a simplified version for explanation purposes. -->
<script>
  import { useLoader } from '@threlte/core'

  let { loaderOptions } = $props()

  const { load } = useLoader(loader, loaderOptions)
</script>
```

A common use for `loaderOptions` is to set the path for the loader to load files from. Assuming all your files live in the same directory, you can simplify loading.

```svelte title="Scene.svelte"
<script>
  import { useTask } from '@threlte/core'

  // don't have to type out the absolute path for each resource
  const urls = ['file1.hdr', 'file2.hdr']
  let index = $state(0)
  const url = $derived(urls[index])

  const interval = 5

  let time = interval
  // count down time and swap every `interval` seconds
  useTask((delta) => {
    time -= delta
    if (time <= 0) {
      index = (index + 1) % resources.length
      time = interval
    }
  })
</script>

<Environment
  {url}
  loaderOptions={{
    extend(loader) {
      loader.setPath('/path/to/your/files/')
    }
  }}
/>
```

If your files live online somewhere you can set the url of the loader and refer to your files by filename.

```svelte title="Scene.svelte"
<Environment
  url="file.hdr"
  loaderOptions={{
    extend(loader) {
      loader.setPath('https://my-cool-site.com/')
    }
  }}
/>
```

The `loaderOptions` prop is where you'd set credentials, headers, etc. for the loader. See [ThreeJS's Loader docs](https://threejs.org/docs/index.html#api/en/loaders/Loader) for more information.

## Restoring Props When Scene Updates

All of `<Environment>`'s props are reactive, even `scene`. If the `scene` prop is updated, `<Environment>` will restore the initial `environment` and `background` properties of the last scene.

The example below creates a custom render task that draws two scenes to the canvas - one on the left and one on the right. Pressing the button switches the environment to be applied to either the left or the right side. You can observe that when `side` updates, the original `background` and `environment` for the previous side are restored.

<Example path="extras/environment/swapping-scenes" />

## Suspended Loading

Textures are suspended so they may be used in a suspense context. This means if you're fetching the file over a slow network, you can show something in the "fallback" snippet of a [\<Suspense>]('/docs/reference/extras/suspense') component while the texture is being fetched and loaded.

```svelte title="Scene.svelte"
<script>
  import { Suspense, Text } from '@threlte/extras'
</script>

<Suspense>
  {#snippet fallback()}
    <Text text="loading environment" />
  {/snippet}
  <Environment
    url="https//url-of-your-file.hdr"
    loaderOptions={{
      extend(loader) {
        loader.setCrossOrigin(/* ... */)
        loader.setWithCredentials(/* ... */)
        loader.setRequestHeader(/* ... */)
      }
    }}
  />
</Suspense>
```

Note that suspension only occurs if `url` is provided. When a texture is provided, there is nothing that needs to loaded, so there's nothing that needs to be suspended.

## Grounded Skyboxes

`<Environment>` also supports ground projected environment mapping through threejs's [GroundedSkybox](https://threejs.org/examples/#webgl_materials_envmaps_groundprojected) addon. To use this feature, set `ground` to `true` or an object with optional `height`, `radius` and `resolution` props. `height` defaults to `1`, `radius` to `1`, and `resolution` to `128`

<Example path="extras/environment/ground-projection" />

The bindable prop `skybox` is a reference to the created `GroundedSkybox` instance. When using this feature, ThreeJS recommends setting the instance's `position.y` to `height`. This will position the "flat" part of the skybox at the origin.

```svelte title="Scene.svelte"
<script>
  let skybox = $state() // GroundedSkybox | undefined

  const height = 15

  $effect(() => {
    skybox?.position.setY(height)
  })
</script>

<Environment
  bind:skybox
  url="file.hdr"
  ground={{ height }}
/>
```

There are a couple of important things to consider when using the `ground` property:

1. `skybox` is only set to a `GroundedSkybox` instance if `ground` !== `false` and **after** the texture is available. It is set to `undefined` when `<Environment>` unmounts.

2. A new instance of `GroundedSkybox` is created whenever the `ground` prop updates to something other than `false`. This is a limitation of the addon. If you need to modify the skybox's properties, try to do it through the `skybox` bindable to avoid creating and destroying multiple instances.

3. `scene.environment` and/or `scene.background` are still set to the environment map. This is done so that the environment map still affects materials used in the scene.
