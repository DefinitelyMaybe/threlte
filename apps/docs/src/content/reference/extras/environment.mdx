---
order: 7.15
category: '@threlte/extras'
sourcePath: 'packages/extras/src/lib/components/environment/Environment.svelte'
name: <Environment>
type: 'component'
componentSignature:
  {
    props:
      [
        { description: 'the file to load', name: 'file', required: true, type: 'string' },
        {
          default: 'false',
          description: 'whether to set `scene.background` to the loaded environment texture',
          name: 'isBackground',
          required: false,
          type: 'boolean'
        },
        {
          default: 'useThrelte().scene',
          description: 'the scene that will have its environment and/or background set',
          name: 'scene',
          required: false,
          type: 'THREE.Scene'
        },
        {
          description: "options object that is used in the loader's `load` function",
          name: 'loadOptions',
          required: false,
          type: 'UseLoaderLoadOptions<Three.EXRLoader | Three.RGBELoader | Three.TextureLoader>',
          default: '{
            transform(texture) {
            texture.mapping = Three.EquirectangularReflectionMapping
            return texture
            }
            }'
        },
        {
          description: 'options object that is used passed to the `useLoader` function',
          name: 'loaderOptions',
          required: false,
          type: 'UseLoaderOptions<typeof Three.EXRLoader | typeof Three.RGBELoader | typeof Three.TextureLoader>'
        }
      ]
  }
---

Asynchronously loads a single environment texture and sets the provided scene's `environment` and or `background` to the texture when loaded. Designed to handle equirectangular environment textures. [Here](/environment-maps/jpg/equirect_ruined_room.jpg) is an example of such a texture.

<Example path="extras/environment/basic" />

## Loading Different File Types

`<Environment>` supports loading `.exr`, `.hdr`, and any file type that can be loaded by ThreeJS's [TextureLoader](https://threejs.org/docs/#api/en/loaders/TextureLoader) such as `.jpg` files. This means you can swap the `file` prop at any time and `<Environment>` will dispose of the previous texture and assign the new one to the scene's `environment` and/or `background` properties. Loaders within `<Environment>` are created on demand and cached for future use until `<Environment>` unmounts.

<Tip type="info">
	`<Environment>` only holds onto one texture. Any time it has to load a new texture, it will dispose of the old one. The texture is also disposed when `<Environment>` unmounts.
</Tip>

Internally `<Environment>` creates a loader based on the extension of the `file` prop. Refer to the table below to determine what kind of loader is used for a particular file.

| file extension | loader                                                                                             |
| -------------- | -------------------------------------------------------------------------------------------------- |
| .exr           | [Three.EXRLoader](https://github.com/mrdoob/three.js/blob/dev/examples/jsm/loaders/EXRLoader.js/)  |
| .hdr           | [Three.RGBELoader](https://github.com/mrdoob/three.js/blob/dev/examples/jsm/loaders/RGBELoader.js) |
| all others     | [Three.TextureLoader](https://threejs.org/docs/#api/en/loaders/TextureLoader)                      |

As previously mentioned, `file` should at least be something that can be loaded by `Three.TextureLoader`.

## Environment's Loader Props

`<Environment>` uses [useLoader](/docs/reference/core/use-loader) internally to create a loader for loading environment texture files.

### `loadOptions`

The `loadOptions` prop is used to modifying textures after they are loaded but before they are assigned to `scene.environment`. It corresponds to the `load` function of the object returned from `useLoader`. In other words, it is used in the following manner,

```svelte title="Environment.svelte"
<!-- Note this is a simplified version for explanation purposes. -->
<script>
  import { useLoader } from '@threlte/core'

  let { file, loadOptions } = $props()

  const { load } = useLoader(loader)

  $effect(() => {
    load(file, loadOptions)
  })
</script>
```

`loadOptions` is only accessed **before** it is applied to `scene.environment`. This means that if you modify the texture via `loadOptions`, it will not be reflected in the environment unless the loader has to load a new texture. The default `loadOptions` sets the `texture.mapping` to `Three.EquirectangularReflectionMapping`.

<Tip type="warning">
  ThreeJS considers environment maps to be static. This means that if you modify the texture somehow
  after it has been assigned to `scene.environment`, the changes will not be visually present.
</Tip>

The example below uses the `loadOptions` prop to flip the loaded texture over the x-axis. Notice how toggling the checkbox does not cause the texture to flip. If you however toggle the checkbox and then switch the file, the displayed texture will match the state of "flipY".

<Example path="extras/environment/modifying-the-texture" />

### `loaderOptions`

The `loaderOptions` prop is used to modify the loader after it is created and to pass argument's to the loader's constructor.

```svelte title="Environment.svelte"
<!-- Note this is a simplified version for explanation purposes. -->
<script>
  import { useLoader } from '@threlte/core'

  let { loaderOptions } = $props()

  const { load } = useLoader(loader, loaderOptions)
</script>
```

A common use for `loaderOptions` is to set the path for the loader to load files from. Assuming all your files live in the same directory, you can simplify loading them like so:

```svelte
<Environment
  file="file.hdr"
  loaderOptions={{
    extend(loader) {
      loader.setPath('/path/to/your/files')
    }
  }}
/>
```

If your files live online somewhere you can set the url of the loader and refer to your files by filename.

```svelte
<Environment
  file="file.hdr"
  loaderOptions={{
    extend(loader) {
      loader.setPath('https://my-cool-site.com/')
    }
  }}
/>
```

The `loaderOptions` prop is where you'd set credentials, headers, etc. for the loader as well. See [ThreeJS's Loader docs](https://threejs.org/docs/index.html#api/en/loaders/Loader) for more information.

## Restoring Environment and Background When Scene Updates

All of `<Environment>`'s props are reactive, even `scene`. If the `scene` prop is updated, `<Environment>` will restore the initial `environment` and `background` properties of the last scene.

The example below creates a custom render task that draws two scenes to the canvas - one on the left and one on the right. Pressing the button switches the environment map to be applied to either the left or the right side. You can observe that when the side updates, the original `background` and `environment` for that side are restored.

<Example path="extras/environment/swapping-scenes" />

## Suspended Loading

Textures are suspended so they may be used in a suspense context. This means if you're fetching the file over a slow network, you can show something in the "fallback" snippet of a [\<Suspense>]('/docs/reference/extras/suspense') component.

```svelte
<script>
  import { Suspense, Text } from '@threlte/extras'
</script>

<Suspense>
  {#snippet fallback()}
    <Text text="loading environment" />
  {/snippet}
  <Environment
    file="https//url-of-your-file.hdr"
    loaderOptions={{
      extend(loader) {
        loader.setCrossOrigin(/* ... */)
        loader.setWithCredentials(/* ... */)
        loader.setRequestHeader(/* ... */)
      }
    }}
  />
</Suspense>
```

<Example path="extras/environment/bring-your-own-texture" />
